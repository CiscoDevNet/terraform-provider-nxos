resource "nxos_bgp" "example" {
  admin_state                              = "enabled"
  instance_admin_state                     = "enabled"
  asn                                      = "65001"
  control                                  = "stateful-ha"
  disable_policy_batching                  = "disabled"
  disable_policy_batching_nexthop          = "disabled"
  disable_policy_batching_ipv4_prefix_list = "PFX_LIST1"
  disable_policy_batching_ipv6_prefix_list = "PFX_LIST_V6"
  enhanced_error_handling                  = false
  fabric_soo                               = "extended:as2-nn4:65001:100"
  flush_routes                             = "disabled"
  isolate                                  = "disabled"
  isolate_route_map                        = "ISO_RT_MAP"
  med_dampening_interval                   = 60
  nexthop_suppress_default_resolution      = "disabled"
  rd_dual                                  = "enabled"
  rd_dual_id                               = 1
  vrfs = [{
    name                               = "default"
    router_id                          = "1.1.1.1"
    alloc_index                        = 1
    bestpath_first_always              = "disabled"
    bestpath_interval                  = 300
    bandwidth_reference                = 40000
    bandwidth_reference_unit           = "mbps"
    cluster_id                         = "1.2.3.4"
    hold_time                          = 180
    keepalive_interval                 = 60
    local_asn                          = "65010"
    max_as_limit                       = 1
    mode                               = "fabric"
    prefix_peer_timeout                = 90
    prefix_peer_wait_time              = 90
    reconnect_interval                 = 60
    router_id_auto                     = "disabled"
    route_control_enforce_first_as     = "disabled"
    route_control_fib_accelerate       = "enabled"
    route_control_log_neighbor_changes = "enabled"
    route_control_suppress_routes      = "disabled"
    graceful_restart_control           = "complete"
    graceful_restart_interval          = 240
    graceful_restart_stale_interval    = 1800
    address_families = [{
      address_family                         = "ipv4-ucast"
      critical_nexthop_timeout               = "2500"
      non_critical_nexthop_timeout           = "8000"
      advertise_l2vpn_evpn                   = "disabled"
      advertise_physical_ip_for_type5_routes = "disabled"
      max_ecmp_paths                         = 2
      max_external_ecmp_paths                = 1
      max_external_internal_ecmp_paths       = 1
      max_local_ecmp_paths                   = 1
      max_mixed_ecmp_paths                   = 1
      default_information_originate          = "disabled"
      next_hop_route_map_name                = "ROUTEMAP1"
      prefix_priority                        = "none"
      retain_rt_all                          = "disabled"
      advertise_only_active_routes           = "disabled"
      table_map_route_map_name               = "ROUTE_MAP1"
      vni_ethernet_tag                       = "disabled"
      wait_igp_converged                     = "disabled"
      advertise_system_mac                   = "disabled"
      allocate_label_all                     = "disabled"
      allocate_label_option_b                = "enabled"
      allocate_label_route_map               = "LABEL_RT_MAP"
      bestpath_origin_as_allow_invalid       = "disabled"
      bestpath_origin_as_use_validity        = "disabled"
      client_to_client_reflection            = "enabled"
      default_metric                         = "100"
      export_gateway_ip                      = "disabled"
      igp_metric                             = 600
      label_allocation_mode                  = "enabled"
      max_path_unequal_cost                  = "disabled"
      nexthop_load_balance_egress_multisite  = "disabled"
      originate_map                          = "ORIG_MAP"
      origin_as_validate                     = "disabled"
      origin_as_validate_signal_ibgp         = "disabled"
      retain_rt_route_map                    = "RETAIN_RT_MAP"
      table_map_filter                       = "disabled"
      timer_bestpath_defer                   = 100
      timer_bestpath_defer_max               = 300
      advertised_prefixes = [{
        prefix    = "192.168.1.0/24"
        route_map = "rt-map"
        evpn      = "enabled"
      }]
      redistributions = [{
        protocol          = "ospf"
        protocol_instance = "OSPF1"
        route_map         = "route_map_ospf_1"
        scope             = "inter"
        srv6_prefix_type  = "unspecified"
        asn               = "65001"
      }]
    }]
    peer_templates = [{
      name                           = "SPINE-PEERS"
      remote_asn                     = "65002"
      description                    = "My Description"
      peer_type                      = "fabric-internal"
      source_interface               = "lo0"
      admin_state                    = "enabled"
      affinity_group                 = 0
      asn_type                       = "none"
      bfd_type                       = "none"
      bmp_server_1                   = "disabled"
      bmp_server_2                   = "disabled"
      capability_suppress_4_byte_asn = "disabled"
      connection_mode                = "passive"
      peer_control                   = "bfd"
      hold_time                      = 180
      keepalive_interval             = 60
      log_neighbor_changes           = "none"
      low_memory_exempt              = "disabled"
      max_peer_count                 = 1
      password_type                  = "LINE"
      password                       = "secret_password"
      private_as_control             = "none"
      session_template               = "SESS_TEMPLATE"
      ebgp_multihop_ttl              = 2
      ttl_security_hops              = 1
      peer_template_address_families = [{
        address_family                = "ipv4-ucast"
        control                       = "nh-self,rr-client"
        send_community_extended       = "enabled"
        send_community_standard       = "enabled"
        advertise_gateway_ip          = "enabled"
        advertisement_interval        = 1
        advertise_local_labeled_route = "enabled"
        aigp                          = "disabled"
        allowed_self_as_count         = 0
        as_override                   = "disabled"
        default_originate             = "disabled"
        default_originate_route_map   = "DEF_ORIG_MAP"
        dmz_link_bandwidth            = "disabled"
        encapsulation_mpls            = "disabled"
        link_bandwidth_cumulative     = "disabled"
        nexthop_thirdparty            = "enabled"
        rewrite_rt_asn                = "disabled"
        soft_reconfiguration_backup   = "none"
        site_of_origin                = "extended:as2-nn4:65001:200"
        unsuppress_map                = "UNSUPP_MAP"
        weight                        = "100"
        max_prefix_action             = "restart"
        max_prefix_number             = 10000
        max_prefix_restart_time       = 1
        max_prefix_threshold          = 30
      }]
    }]
    peers = [{
      address                        = "192.168.0.1"
      remote_asn                     = "65002"
      description                    = "My description"
      peer_template                  = "SPINE-PEERS"
      peer_type                      = "fabric-internal"
      source_interface               = "lo0"
      hold_time                      = 45
      keepalive_interval             = 15
      ebgp_multihop_ttl              = 5
      peer_control                   = "bfd,dis-conn-check"
      password_type                  = "LINE"
      password                       = "secret_password"
      admin_state                    = "enabled"
      affinity_group                 = 0
      asn_type                       = "none"
      bfd_type                       = "none"
      bmp_server_1                   = "disabled"
      bmp_server_2                   = "disabled"
      capability_suppress_4_byte_asn = "disabled"
      connection_mode                = "passive"
      log_neighbor_changes           = "none"
      low_memory_exempt              = "disabled"
      max_peer_count                 = 1
      private_as_control             = "none"
      session_template               = "SESS_TEMPLATE"
      ttl_security_hops              = 1
      local_asn_propagation          = "no-prepend"
      local_asn                      = "65001"
      peer_address_families = [{
        address_family                = "ipv4-ucast"
        control                       = "nh-self"
        send_community_extended       = "enabled"
        send_community_standard       = "enabled"
        advertise_gateway_ip          = "enabled"
        advertisement_interval        = 1
        advertise_local_labeled_route = "enabled"
        aigp                          = "disabled"
        allowed_self_as_count         = 0
        as_override                   = "disabled"
        default_originate             = "disabled"
        default_originate_route_map   = "DEF_ORIG_MAP"
        dmz_link_bandwidth            = "disabled"
        encapsulation_mpls            = "disabled"
        link_bandwidth_cumulative     = "disabled"
        nexthop_thirdparty            = "enabled"
        rewrite_rt_asn                = "disabled"
        soft_reconfiguration_backup   = "none"
        site_of_origin                = "extended:as2-nn4:65001:200"
        unsuppress_map                = "UNSUPP_MAP"
        weight                        = "100"
        route_controls = [{
          direction      = "in"
          route_map_name = "ROUTE_MAP1"
        }]
        prefix_list_controls = [{
          direction = "in"
          list      = "PREFIX_LIST1"
        }]
      }]
    }]
  }]
}
